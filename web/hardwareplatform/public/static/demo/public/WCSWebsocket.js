!function(e,t){if("object"==typeof exports&&"object"==typeof module)module.exports=t();else if("function"==typeof define&&define.amd)define([],t);else{var i=t();for(var s in i)("object"==typeof exports?exports:e)[s]=i[s]}}(window,(function(){return function(e){var t={};function i(s){if(t[s])return t[s].exports;var o=t[s]={i:s,l:!1,exports:{}};return e[s].call(o.exports,o,o.exports,i),o.l=!0,o.exports}return i.m=e,i.c=t,i.d=function(e,t,s){i.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:s})},i.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},i.t=function(e,t){if(1&t&&(e=i(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var s=Object.create(null);if(i.r(s),Object.defineProperty(s,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)i.d(s,o,function(t){return e[t]}.bind(null,o));return s},i.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return i.d(t,"a",t),t},i.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},i.p="",i(i.s=4)}([function(module,exports,__webpack_require__){(function(process,global){var __WEBPACK_AMD_DEFINE_RESULT__;
/**
 * [js-md5]{@link https://github.com/emn178/js-md5}
 *
 * @namespace md5
 * @version 0.7.3
 * @author Chen, Yi-Cyuan [emn178@gmail.com]
 * @copyright Chen, Yi-Cyuan 2014-2017
 * @license MIT
 */!function(){"use strict";var ERROR="input is invalid type",WINDOW="object"==typeof window,root=WINDOW?window:{};root.JS_MD5_NO_WINDOW&&(WINDOW=!1);var WEB_WORKER=!WINDOW&&"object"==typeof self,NODE_JS=!root.JS_MD5_NO_NODE_JS&&"object"==typeof process&&process.versions&&process.versions.node;NODE_JS?root=global:WEB_WORKER&&(root=self);var COMMON_JS=!root.JS_MD5_NO_COMMON_JS&&"object"==typeof module&&module.exports,AMD=__webpack_require__(3),ARRAY_BUFFER=!root.JS_MD5_NO_ARRAY_BUFFER&&"undefined"!=typeof ArrayBuffer,HEX_CHARS="0123456789abcdef".split(""),EXTRA=[128,32768,8388608,-2147483648],SHIFT=[0,8,16,24],OUTPUT_TYPES=["hex","array","digest","buffer","arrayBuffer","base64"],BASE64_ENCODE_CHAR="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".split(""),blocks=[],buffer8;if(ARRAY_BUFFER){var buffer=new ArrayBuffer(68);buffer8=new Uint8Array(buffer),blocks=new Uint32Array(buffer)}!root.JS_MD5_NO_NODE_JS&&Array.isArray||(Array.isArray=function(e){return"[object Array]"===Object.prototype.toString.call(e)}),!ARRAY_BUFFER||!root.JS_MD5_NO_ARRAY_BUFFER_IS_VIEW&&ArrayBuffer.isView||(ArrayBuffer.isView=function(e){return"object"==typeof e&&e.buffer&&e.buffer.constructor===ArrayBuffer});var createOutputMethod=function(e){return function(t){return new Md5(!0).update(t)[e]()}},createMethod=function(){var e=createOutputMethod("hex");NODE_JS&&(e=nodeWrap(e)),e.create=function(){return new Md5},e.update=function(t){return e.create().update(t)};for(var t=0;t<OUTPUT_TYPES.length;++t){var i=OUTPUT_TYPES[t];e[i]=createOutputMethod(i)}return e},nodeWrap=function(method){var crypto=eval("require('crypto')"),Buffer=eval("require('buffer').Buffer"),nodeMethod=function(e){if("string"==typeof e)return crypto.createHash("md5").update(e,"utf8").digest("hex");if(null==e)throw ERROR;return e.constructor===ArrayBuffer&&(e=new Uint8Array(e)),Array.isArray(e)||ArrayBuffer.isView(e)||e.constructor===Buffer?crypto.createHash("md5").update(new Buffer(e)).digest("hex"):method(e)};return nodeMethod};function Md5(e){if(e)blocks[0]=blocks[16]=blocks[1]=blocks[2]=blocks[3]=blocks[4]=blocks[5]=blocks[6]=blocks[7]=blocks[8]=blocks[9]=blocks[10]=blocks[11]=blocks[12]=blocks[13]=blocks[14]=blocks[15]=0,this.blocks=blocks,this.buffer8=buffer8;else if(ARRAY_BUFFER){var t=new ArrayBuffer(68);this.buffer8=new Uint8Array(t),this.blocks=new Uint32Array(t)}else this.blocks=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];this.h0=this.h1=this.h2=this.h3=this.start=this.bytes=this.hBytes=0,this.finalized=this.hashed=!1,this.first=!0}Md5.prototype.update=function(e){if(!this.finalized){var t,i=typeof e;if("string"!==i){if("object"!==i)throw ERROR;if(null===e)throw ERROR;if(ARRAY_BUFFER&&e.constructor===ArrayBuffer)e=new Uint8Array(e);else if(!(Array.isArray(e)||ARRAY_BUFFER&&ArrayBuffer.isView(e)))throw ERROR;t=!0}for(var s,o,r=0,n=e.length,a=this.blocks,h=this.buffer8;r<n;){if(this.hashed&&(this.hashed=!1,a[0]=a[16],a[16]=a[1]=a[2]=a[3]=a[4]=a[5]=a[6]=a[7]=a[8]=a[9]=a[10]=a[11]=a[12]=a[13]=a[14]=a[15]=0),t)if(ARRAY_BUFFER)for(o=this.start;r<n&&o<64;++r)h[o++]=e[r];else for(o=this.start;r<n&&o<64;++r)a[o>>2]|=e[r]<<SHIFT[3&o++];else if(ARRAY_BUFFER)for(o=this.start;r<n&&o<64;++r)(s=e.charCodeAt(r))<128?h[o++]=s:s<2048?(h[o++]=192|s>>6,h[o++]=128|63&s):s<55296||s>=57344?(h[o++]=224|s>>12,h[o++]=128|s>>6&63,h[o++]=128|63&s):(s=65536+((1023&s)<<10|1023&e.charCodeAt(++r)),h[o++]=240|s>>18,h[o++]=128|s>>12&63,h[o++]=128|s>>6&63,h[o++]=128|63&s);else for(o=this.start;r<n&&o<64;++r)(s=e.charCodeAt(r))<128?a[o>>2]|=s<<SHIFT[3&o++]:s<2048?(a[o>>2]|=(192|s>>6)<<SHIFT[3&o++],a[o>>2]|=(128|63&s)<<SHIFT[3&o++]):s<55296||s>=57344?(a[o>>2]|=(224|s>>12)<<SHIFT[3&o++],a[o>>2]|=(128|s>>6&63)<<SHIFT[3&o++],a[o>>2]|=(128|63&s)<<SHIFT[3&o++]):(s=65536+((1023&s)<<10|1023&e.charCodeAt(++r)),a[o>>2]|=(240|s>>18)<<SHIFT[3&o++],a[o>>2]|=(128|s>>12&63)<<SHIFT[3&o++],a[o>>2]|=(128|s>>6&63)<<SHIFT[3&o++],a[o>>2]|=(128|63&s)<<SHIFT[3&o++]);this.lastByteIndex=o,this.bytes+=o-this.start,o>=64?(this.start=o-64,this.hash(),this.hashed=!0):this.start=o}return this.bytes>4294967295&&(this.hBytes+=this.bytes/4294967296<<0,this.bytes=this.bytes%4294967296),this}},Md5.prototype.finalize=function(){if(!this.finalized){this.finalized=!0;var e=this.blocks,t=this.lastByteIndex;e[t>>2]|=EXTRA[3&t],t>=56&&(this.hashed||this.hash(),e[0]=e[16],e[16]=e[1]=e[2]=e[3]=e[4]=e[5]=e[6]=e[7]=e[8]=e[9]=e[10]=e[11]=e[12]=e[13]=e[14]=e[15]=0),e[14]=this.bytes<<3,e[15]=this.hBytes<<3|this.bytes>>>29,this.hash()}},Md5.prototype.hash=function(){var e,t,i,s,o,r,n=this.blocks;this.first?t=((t=((e=((e=n[0]-680876937)<<7|e>>>25)-271733879<<0)^(i=((i=(-271733879^(s=((s=(-1732584194^2004318071&e)+n[1]-117830708)<<12|s>>>20)+e<<0)&(-271733879^e))+n[2]-1126478375)<<17|i>>>15)+s<<0)&(s^e))+n[3]-1316259209)<<22|t>>>10)+i<<0:(e=this.h0,t=this.h1,i=this.h2,t=((t+=((e=((e+=((s=this.h3)^t&(i^s))+n[0]-680876936)<<7|e>>>25)+t<<0)^(i=((i+=(t^(s=((s+=(i^e&(t^i))+n[1]-389564586)<<12|s>>>20)+e<<0)&(e^t))+n[2]+606105819)<<17|i>>>15)+s<<0)&(s^e))+n[3]-1044525330)<<22|t>>>10)+i<<0),t=((t+=((e=((e+=(s^t&(i^s))+n[4]-176418897)<<7|e>>>25)+t<<0)^(i=((i+=(t^(s=((s+=(i^e&(t^i))+n[5]+1200080426)<<12|s>>>20)+e<<0)&(e^t))+n[6]-1473231341)<<17|i>>>15)+s<<0)&(s^e))+n[7]-45705983)<<22|t>>>10)+i<<0,t=((t+=((e=((e+=(s^t&(i^s))+n[8]+1770035416)<<7|e>>>25)+t<<0)^(i=((i+=(t^(s=((s+=(i^e&(t^i))+n[9]-1958414417)<<12|s>>>20)+e<<0)&(e^t))+n[10]-42063)<<17|i>>>15)+s<<0)&(s^e))+n[11]-1990404162)<<22|t>>>10)+i<<0,t=((t+=((e=((e+=(s^t&(i^s))+n[12]+1804603682)<<7|e>>>25)+t<<0)^(i=((i+=(t^(s=((s+=(i^e&(t^i))+n[13]-40341101)<<12|s>>>20)+e<<0)&(e^t))+n[14]-1502002290)<<17|i>>>15)+s<<0)&(s^e))+n[15]+1236535329)<<22|t>>>10)+i<<0,t=((t+=((s=((s+=(t^i&((e=((e+=(i^s&(t^i))+n[1]-165796510)<<5|e>>>27)+t<<0)^t))+n[6]-1069501632)<<9|s>>>23)+e<<0)^e&((i=((i+=(e^t&(s^e))+n[11]+643717713)<<14|i>>>18)+s<<0)^s))+n[0]-373897302)<<20|t>>>12)+i<<0,t=((t+=((s=((s+=(t^i&((e=((e+=(i^s&(t^i))+n[5]-701558691)<<5|e>>>27)+t<<0)^t))+n[10]+38016083)<<9|s>>>23)+e<<0)^e&((i=((i+=(e^t&(s^e))+n[15]-660478335)<<14|i>>>18)+s<<0)^s))+n[4]-405537848)<<20|t>>>12)+i<<0,t=((t+=((s=((s+=(t^i&((e=((e+=(i^s&(t^i))+n[9]+568446438)<<5|e>>>27)+t<<0)^t))+n[14]-1019803690)<<9|s>>>23)+e<<0)^e&((i=((i+=(e^t&(s^e))+n[3]-187363961)<<14|i>>>18)+s<<0)^s))+n[8]+1163531501)<<20|t>>>12)+i<<0,t=((t+=((s=((s+=(t^i&((e=((e+=(i^s&(t^i))+n[13]-1444681467)<<5|e>>>27)+t<<0)^t))+n[2]-51403784)<<9|s>>>23)+e<<0)^e&((i=((i+=(e^t&(s^e))+n[7]+1735328473)<<14|i>>>18)+s<<0)^s))+n[12]-1926607734)<<20|t>>>12)+i<<0,t=((t+=((r=(s=((s+=((o=t^i)^(e=((e+=(o^s)+n[5]-378558)<<4|e>>>28)+t<<0))+n[8]-2022574463)<<11|s>>>21)+e<<0)^e)^(i=((i+=(r^t)+n[11]+1839030562)<<16|i>>>16)+s<<0))+n[14]-35309556)<<23|t>>>9)+i<<0,t=((t+=((r=(s=((s+=((o=t^i)^(e=((e+=(o^s)+n[1]-1530992060)<<4|e>>>28)+t<<0))+n[4]+1272893353)<<11|s>>>21)+e<<0)^e)^(i=((i+=(r^t)+n[7]-155497632)<<16|i>>>16)+s<<0))+n[10]-1094730640)<<23|t>>>9)+i<<0,t=((t+=((r=(s=((s+=((o=t^i)^(e=((e+=(o^s)+n[13]+681279174)<<4|e>>>28)+t<<0))+n[0]-358537222)<<11|s>>>21)+e<<0)^e)^(i=((i+=(r^t)+n[3]-722521979)<<16|i>>>16)+s<<0))+n[6]+76029189)<<23|t>>>9)+i<<0,t=((t+=((r=(s=((s+=((o=t^i)^(e=((e+=(o^s)+n[9]-640364487)<<4|e>>>28)+t<<0))+n[12]-421815835)<<11|s>>>21)+e<<0)^e)^(i=((i+=(r^t)+n[15]+530742520)<<16|i>>>16)+s<<0))+n[2]-995338651)<<23|t>>>9)+i<<0,t=((t+=((s=((s+=(t^((e=((e+=(i^(t|~s))+n[0]-198630844)<<6|e>>>26)+t<<0)|~i))+n[7]+1126891415)<<10|s>>>22)+e<<0)^((i=((i+=(e^(s|~t))+n[14]-1416354905)<<15|i>>>17)+s<<0)|~e))+n[5]-57434055)<<21|t>>>11)+i<<0,t=((t+=((s=((s+=(t^((e=((e+=(i^(t|~s))+n[12]+1700485571)<<6|e>>>26)+t<<0)|~i))+n[3]-1894986606)<<10|s>>>22)+e<<0)^((i=((i+=(e^(s|~t))+n[10]-1051523)<<15|i>>>17)+s<<0)|~e))+n[1]-2054922799)<<21|t>>>11)+i<<0,t=((t+=((s=((s+=(t^((e=((e+=(i^(t|~s))+n[8]+1873313359)<<6|e>>>26)+t<<0)|~i))+n[15]-30611744)<<10|s>>>22)+e<<0)^((i=((i+=(e^(s|~t))+n[6]-1560198380)<<15|i>>>17)+s<<0)|~e))+n[13]+1309151649)<<21|t>>>11)+i<<0,t=((t+=((s=((s+=(t^((e=((e+=(i^(t|~s))+n[4]-145523070)<<6|e>>>26)+t<<0)|~i))+n[11]-1120210379)<<10|s>>>22)+e<<0)^((i=((i+=(e^(s|~t))+n[2]+718787259)<<15|i>>>17)+s<<0)|~e))+n[9]-343485551)<<21|t>>>11)+i<<0,this.first?(this.h0=e+1732584193<<0,this.h1=t-271733879<<0,this.h2=i-1732584194<<0,this.h3=s+271733878<<0,this.first=!1):(this.h0=this.h0+e<<0,this.h1=this.h1+t<<0,this.h2=this.h2+i<<0,this.h3=this.h3+s<<0)},Md5.prototype.hex=function(){this.finalize();var e=this.h0,t=this.h1,i=this.h2,s=this.h3;return HEX_CHARS[e>>4&15]+HEX_CHARS[15&e]+HEX_CHARS[e>>12&15]+HEX_CHARS[e>>8&15]+HEX_CHARS[e>>20&15]+HEX_CHARS[e>>16&15]+HEX_CHARS[e>>28&15]+HEX_CHARS[e>>24&15]+HEX_CHARS[t>>4&15]+HEX_CHARS[15&t]+HEX_CHARS[t>>12&15]+HEX_CHARS[t>>8&15]+HEX_CHARS[t>>20&15]+HEX_CHARS[t>>16&15]+HEX_CHARS[t>>28&15]+HEX_CHARS[t>>24&15]+HEX_CHARS[i>>4&15]+HEX_CHARS[15&i]+HEX_CHARS[i>>12&15]+HEX_CHARS[i>>8&15]+HEX_CHARS[i>>20&15]+HEX_CHARS[i>>16&15]+HEX_CHARS[i>>28&15]+HEX_CHARS[i>>24&15]+HEX_CHARS[s>>4&15]+HEX_CHARS[15&s]+HEX_CHARS[s>>12&15]+HEX_CHARS[s>>8&15]+HEX_CHARS[s>>20&15]+HEX_CHARS[s>>16&15]+HEX_CHARS[s>>28&15]+HEX_CHARS[s>>24&15]},Md5.prototype.toString=Md5.prototype.hex,Md5.prototype.digest=function(){this.finalize();var e=this.h0,t=this.h1,i=this.h2,s=this.h3;return[255&e,e>>8&255,e>>16&255,e>>24&255,255&t,t>>8&255,t>>16&255,t>>24&255,255&i,i>>8&255,i>>16&255,i>>24&255,255&s,s>>8&255,s>>16&255,s>>24&255]},Md5.prototype.array=Md5.prototype.digest,Md5.prototype.arrayBuffer=function(){this.finalize();var e=new ArrayBuffer(16),t=new Uint32Array(e);return t[0]=this.h0,t[1]=this.h1,t[2]=this.h2,t[3]=this.h3,e},Md5.prototype.buffer=Md5.prototype.arrayBuffer,Md5.prototype.base64=function(){for(var e,t,i,s="",o=this.array(),r=0;r<15;)e=o[r++],t=o[r++],i=o[r++],s+=BASE64_ENCODE_CHAR[e>>>2]+BASE64_ENCODE_CHAR[63&(e<<4|t>>>4)]+BASE64_ENCODE_CHAR[63&(t<<2|i>>>6)]+BASE64_ENCODE_CHAR[63&i];return e=o[r],s+=BASE64_ENCODE_CHAR[e>>>2]+BASE64_ENCODE_CHAR[e<<4&63]+"=="};var exports=createMethod();COMMON_JS?module.exports=exports:(root.md5=exports,AMD&&(__WEBPACK_AMD_DEFINE_RESULT__=function(){return exports}.call(exports,__webpack_require__,exports,module),void 0===__WEBPACK_AMD_DEFINE_RESULT__||(module.exports=__WEBPACK_AMD_DEFINE_RESULT__)))}()}).call(this,__webpack_require__(1),__webpack_require__(2))},function(e,t){var i,s,o=e.exports={};function r(){throw new Error("setTimeout has not been defined")}function n(){throw new Error("clearTimeout has not been defined")}function a(e){if(i===setTimeout)return setTimeout(e,0);if((i===r||!i)&&setTimeout)return i=setTimeout,setTimeout(e,0);try{return i(e,0)}catch(t){try{return i.call(null,e,0)}catch(t){return i.call(this,e,0)}}}!function(){try{i="function"==typeof setTimeout?setTimeout:r}catch(e){i=r}try{s="function"==typeof clearTimeout?clearTimeout:n}catch(e){s=n}}();var h,c=[],_=!1,l=-1;function u(){_&&h&&(_=!1,h.length?c=h.concat(c):l=-1,c.length&&f())}function f(){if(!_){var e=a(u);_=!0;for(var t=c.length;t;){for(h=c,c=[];++l<t;)h&&h[l].run();l=-1,t=c.length}h=null,_=!1,function(e){if(s===clearTimeout)return clearTimeout(e);if((s===n||!s)&&clearTimeout)return s=clearTimeout,clearTimeout(e);try{s(e)}catch(t){try{return s.call(null,e)}catch(t){return s.call(this,e)}}}(e)}}function d(e,t){this.fun=e,this.array=t}function g(){}o.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var i=1;i<arguments.length;i++)t[i-1]=arguments[i];c.push(new d(e,t)),1!==c.length||_||a(f)},d.prototype.run=function(){this.fun.apply(null,this.array)},o.title="browser",o.browser=!0,o.env={},o.argv=[],o.version="",o.versions={},o.on=g,o.addListener=g,o.once=g,o.off=g,o.removeListener=g,o.removeAllListeners=g,o.emit=g,o.prependListener=g,o.prependOnceListener=g,o.listeners=function(e){return[]},o.binding=function(e){throw new Error("process.binding is not supported")},o.cwd=function(){return"/"},o.chdir=function(e){throw new Error("process.chdir is not supported")},o.umask=function(){return 0}},function(e,t){var i;i=function(){return this}();try{i=i||new Function("return this")()}catch(e){"object"==typeof window&&(i=window)}e.exports=i},function(e,t){(function(t){e.exports=t}).call(this,{})},function(e,t,i){"use strict";i.r(t);const s={KError:-2,kIdle:-1,kConnecting:0,kOpening:1,kClosing:2,kClosed:3};function o(e){return null==e||""===e}var r=i(0),n=i.n(r);var a=class{constructor(e){this.VERSION="1.0.0",this._Sbox=[],this._is_inited=!1,this._Sbox_index_i=0,this._Sbox_index_j=0;try{if(null==e||""===e)throw new Error("Key is an illegal format.");if("[object String]"!==Object.prototype.toString.call(e))throw new Error("Key is an illegal format.");{let t=0;for(let i=0;i<256;i++)this._Sbox[i]=i,t=(t+i+e.charCodeAt(i%e.length))%256,[this._Sbox[i],this._Sbox[t]]=[this._Sbox[t],this._Sbox[i]];this._is_inited=!0,console.log("Rc4 init end")}}catch(e){throw console.error(e),e}}crypt(e){try{if(!0!==this._is_inited)throw new Error("Rc4 is not init.");if("[object Array]"===Object.prototype.toString.call(e)){for(let t=0;t<e.length;t++){this._Sbox_index_i=(this._Sbox_index_i+1)%256,this._Sbox_index_j=(this._Sbox_index_j+this._Sbox[this._Sbox_index_i])%256,[this._Sbox[this._Sbox_index_i],this._Sbox[this._Sbox_index_j]]=[this._Sbox[this._Sbox_index_j],this._Sbox[this._Sbox_index_i]];let i=(this._Sbox[this._Sbox_index_i]+this._Sbox[this._Sbox_index_j])%256;e[t]=e[t]^this._Sbox[i],i=null}return e}throw new Error("Crypt data is an illegal format.")}catch(e){console.error(e)}}};const h={G711A:8e3,G711U:8e3,G722:16e3,G723:8e3,G726:8e3};var c=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var s in i)Object.prototype.hasOwnProperty.call(i,s)&&(e[s]=i[s])}return e};class _{static isSupported(){try{return void 0!==self.WebSocket}catch(e){return!1}}constructor(e){this.url="",this.ws=null,this.config={api_version:2,enc_type:0,enc_key:"",pingTimeout:1e4,pongTimeout:1e4,pingMsg:"\r\n",reconnectLimit:0,reconnectTimeout:3e3,isDebug:!1,isAutoLogin:!0},this.WCS_ID=function(){const e=+new Date+"";return(+(parseInt(65536*(1+Math.random()))+""+e)).toString(32)}(),this.reconnectTime=0,this.lockReconnect=!1,this.forbidReconnect=!1,this._send_rc4=null,this._receive_rc4=null,e&&(this.config=function e(t,i){return"object"!=typeof t&&(t={}),Array.isArray(i)?i.slice():(Object.keys(i).forEach(s=>{const o=i[s];t[s]="object"==typeof o?e(t[s],o):o}),t)}(this.config,e)),this.TAG="WCS_WS",this._status=s.kIdle,this._loginType="",this._loginParams={},this._isLogin=!1,this._msg_id=0,this._messageBox=[],this._pingIntervalId=0,this._pongTimeoutId=0,this._reconnectTimeoutId=0,this._requestAbort=!1,this._onLogin=null,this._onClassError=null,this._selfReconnect=null}destroy(){this._Log("Start destroy"),this.ws&&this.abort(),clearTimeout(this._reconnectTimeoutId),clearTimeout(this._pingIntervalId),clearTimeout(this._pongTimeoutId),this._onLogin=null,this._onClassError=null,this._selfReconnect=null,this.onclose=()=>{},this.onerror=()=>{},this.onopen=()=>{},this.onmessage=()=>{},this.onreceive=()=>{},this._messageBox=null,this._status=s.kIdle,this._Log("Finished destroy"),this.config=null}abort(){!this.ws||0!==this.ws.readyState&&1!==this.ws.readyState||(this._requestAbort=!0,this.close()),this.ws=null,this._status=s.kClosed}open(e,t){try{if(!/wss?:\/\/(.+?)/.test(e))return void this._handleThrowError({err_msg:"错误的websocket链接地址",code:1400});if(this._setLoginType(t),""===this._loginType)return void this._handleThrowError({err_msg:"没有登录凭证",code:1400});this.ws=new WebSocket(e),this._Log("Create ws",this.ws),this.ws.binaryType="arraybuffer",this.ws.onopen=this._onWebSocketOpen.bind(this),this.ws.onclose=this._onWebSocketClose.bind(this),this.ws.onmessage=this._onWebSocketMessage.bind(this),this.ws.onerror=this._onWebSocketError.bind(this),this._status=s.kConnecting}catch(e){this._status=s.kError,this._handleThrowError(e)}}getMsgId(){return++this._msg_id}isWorking(){return this.ws.readyState===WebSocket.OPEN}isLogined(){return this._isLogin}getWSStatus(){return this.ws?this.ws.readyState:s.kClosed}get status(){return this._status}get onLogin(){return this._onLogin}set onLogin(e){this._onLogin=e}get onClassError(){return this._onClassError}set onClassError(e){this._onClassError=e}get reconnect(){return this._selfReconnect}set reconnect(e){this._selfReconnect=e}onclose(){}onerror(){}onopen(){}onmessage(){}onreceive(){}send(e,t){this.isWorking()?e&&"[object Object]"===Object.prototype.toString.call(e)?(e.msg_id||(e.msg_id=this.getMsgId()),t&&"[object Object]"===Object.prototype.toString.call(t)&&(t.msg_id=e.msg_id,this._messageBox.push(t)),this._Log("send message",e,t),e=this._encodeMessage(JSON.stringify(e)),this.ws.send(e)):this._Log("send error format message",e):this._reconnect()}toLogin(){this._Log("toLogin",this._loginParams);let e=null;if(o(this._loginParams.token)){if(o(this._loginParams.user_name)||o(this._loginParams.password))return void this._handleThrowError({err_msg:"没有登录凭证",code:1400});e={version:this.config.api_version,sdk_type:"js",user_name:this._loginParams.user_name}}else e={version:this.config.api_version,sdk_type:"js",with_token:this._loginParams.token};const t={namespace:"",request:"login",msg_id:0,content:e};this.send(t,{msg_id:0,cb:this.toLoginCallback.bind(this)}),this._heartCheck()}toLoginCallback(e){if(401===e.reply&&e.content&&e.content.nonce){this._isLogin=!1,this._Log("login return nonce->",e.content.nonce,e);const t={namespace:"",request:"login",msg_id:0,content:{responce:n()(this._loginParams.user_name+":"+this._loginParams.password+":"+e.content.nonce),enc_type:this.config.enc_type}};this._Log("name:",this._loginParams.user_name,"password:",this._loginParams.password,"nonce:",e.content.nonce),this._Log("login response:",n()(this._loginParams.user_name+":"+this._loginParams.password+":"+e.content.nonce)),this.send(t,{msg_id:0,cb:this.toLoginCallback.bind(this)})}else 200===e.reply&&e.content?(this._Log("login success",e),this.config.enc_type=e.content.enc_type,1===e.content.enc_type&&(this._send_rc4=new a(this.config.enc_key),this._receive_rc4=new a(this.config.enc_key)),this._isLogin=!0,this.reconnectTime=0,this.lockReconnect=!1,this._onLogin&&this._onLogin()):(this._isLogin=!1,this.onerror({err_msg:"Login Websocket Failed",e:e}))}sendAudioBuffer(e,t,i,s){s=s||null,this._Log("send Audio buffer",e,t,i,s);let o=null;o=s?new Uint8Array([87,87,0,65,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]):new Uint8Array([87,87,0,65,0,0,0,0,0,0,0,0,0,0]),(e=parseInt(e))&&!isNaN(e)||(this._Log("stream_id is not valid",e),console.error("stream_id is not valid",e)),o[4]=e>>24,o[5]=e>>16,o[6]=e>>8,o[7]=e,o[9]=s?1:0;const r=new Float32Array([i]),n=new Uint8Array(r.buffer);if(o.set(n,10),s){const e=new Uint8Array([6,0,0,0,0,0]);e[1]=s.channelNum?s.channelNum>2?1:s.channelNum:1,e[2]=s.bitDepth?s.bitDepth>16?16:s.bitDepth:16;const t=s.sampleRate?s.sampleRate:16e3;e[3]=t>>16,e[4]=t>>8,e[5]=t,o.set(e,14)}const a=function(e,t){e=new Uint8Array(e),t=new Uint8Array(t);const i=new Uint8Array(e.length+t.length);let s=0;for(let t=0;t<e.length;t++)i[s]=e[t],s++;for(let e=0;e<t.length;e++)i[s]=t[e],s++;return i}(o,t);this._Log("send audio buffer",a),this.ws.send(a)}close(e){this.forbidReconnect=!0,this._heartReset(),e=void 0!==e?e:1e3,this.ws.close(e),this._Log("Actively Close Websocket")}_handleThrowError(e){if(!this._onClassError)throw new Error(e);this._onClassError(e)}_onWebSocketOpen(e){this._status=s.kConnecting,this._Log("ws is opening"),this.onopen(),this.config.isAutoLogin&&this.toLogin()}_onWebSocketClose(e){!0!==this._requestAbort?(this._status=s.kComplete,this._Log("websocket onclose",e),this.onclose(e),this._heartReset(),this._reconnect()):this._requestAbort=!1}_onWebSocketError(e){this._Log("onerror",e),this.onerror(e)}_onWebSocketMessage(e){if(this.onmessage(event),e.data instanceof ArrayBuffer)this._receive(e.data);else if(e.data instanceof Blob){const t=new FileReader;t.onload=()=>{this._receive(t.result)},t.readAsArrayBuffer(e.data)}else if("String"===e.data.constructor.name)this._receive(e.data);else{this._status=this.getWSStatus();const t={code:400,err_msg:"Unsupported WebSocket message type: "+e.data.constructor.name};this._handleThrowError(t)}}_reconnect(){if(this._messageBox=[],this._selfReconnect)this._Log(`After ${this.config.reconnectTimeout}s Start Custom Reconnect Function`),this._reconnectTimeoutId=setTimeout(()=>{this._Log("Start Custom Reconnect Function"),this._selfReconnect()},this.config.reconnectTimeout);else{if(this.config.reconnectLimit<=0||this.reconnectTime>=this.config.reconnectLimit)return;if(this.lockReconnect||this.forbidReconnect)return;this.lockReconnect=!0,this.reconnectTime++,this._reconnectTimeoutId=setTimeout(()=>{this._Log(`Start ${this.reconnectTime} reconnect`),"username"===this._loginType?(this.open(this.url,this._loginParams),this.lockReconnect=!1):(this.lockReconnect=!1,this._handleThrowError({err_msg:"重连失败"}))},this.config.reconnectTimeout)}}_heartCheck(){this._heartReset(),this._heartStart()}_heartStart(){this.forbidReconnect||(this._pingIntervalId=setInterval(()=>{this._Log("❤ ping"),this.ws.send(this.config.pingMsg),this._pongTimeoutId=setTimeout(()=>{this.ws.close()},this.config.pongTimeout)},this.config.pingTimeout))}_heartReset(){clearInterval(this._pingIntervalId),clearTimeout(this._pongTimeoutId)}_receive(e){if(!e||e===this.config.pingMsg)return e!==this.config.pingMsg&&""!==e||(clearTimeout(this._pongTimeoutId),this._Log("❤ pong")),!1;this._Log("------------------------------------"),this._Log("Websocket Receive Origin Data",e),this._decodeMessage(e).then(e=>{if(this._Log("Decoded Data",e),!e||!e.type||e.data===this.config.pingMsg||""===e.data)return!1;"T"===e.type?this._handleTextMessage(e.data):"V"===e.type?this._handleVideoMessage(e.data):"A"===e.type?this._handleAudioMessage(e.data):this._onerror({err_msg:"Unknown Receive Message Type",e:e})}).catch(e=>!1)}_encodeMessage(e){return this._isLogin&&0!==this.config.enc_type?(1===this.config.enc_type||this._Log("encrypt type error"),e):e}_decodeMessage(e){return new Promise((t,i)=>{if(this._isLogin&&0!==this.config.enc_type)if(1===this.config.enc_type)if("string"==typeof e)t({type:"T",data:e});else{this._Log("Decode unencrypt Media buffer",e);const s=new Uint8Array(e);87===s[0]&&87===s[1]?86===s[3]?t({type:"V",data:s}):65===s[3]&&t({type:"A",data:s}):i()}else i();else if("string"==typeof e)t({type:"T",data:e});else{this._Log("Decode unencrypt Media buffer",e);const s=new Uint8Array(e);87===s[0]&&87===s[1]?86===s[3]?t({type:"V",data:s}):65===s[3]&&t({type:"A",data:s}):i()}})}_handleTextMessage(e){try{this._Log("handleTextMessage",e),e=JSON.parse(e)}catch(e){return this.onhandleerror({err_msg:"Error parsing json message",e:e}),!1}if(this._Log("Receive Text message",e),e.reply){const t=this._messageBox.findIndex(t=>t.msg_id===e.msg_id);if(-1!==t){let i=this._messageBox.splice(t,1);if(i.length>0&&(i=i[0],this._Log("message CB info",i),i.cb))return i.context?void i.cb(e,i.context):void i.cb(e)}}this.onreceive({type:"T",data:e})}_handleVideoMessage(e){if(e){this._Log("Receive Video Message",e);const t=function(e){const t=new Uint8Array(e),i={};let s=0;if(87===t[0]&&87===t[1]&&86===t[3]){switch(t[9]>>4&15){case 1:i.frame="I";break;case 2:i.frame="P";break;case 3:i.frame="B";break;default:i.frame=""}const e=t.slice(10,14),o=new DataView(e.buffer);if(i.timestamp=o.getUint32(0),1&t[9]){switch(t[14]){case 1:i.incodeType="MPEG4";break;case 2:i.incodeType="H264";break;case 3:i.incodeType="H265";break;default:i.incodeType=t[14]}i.frameRate=t[15];const e=new DataView(t.buffer);i.width=e.getUint16(9),i.height=e.getUint16(10),s=20}else s=14;if(t[9]>>1&1){const e=t[s];s++,i.other_spread=t.slice(s,e),s+=e}return{data:t.slice(s),info:i}}return 0===t[0]&&0===t[1]&&(1===t[2]||0===t[2]&&1===t[3])?{data:t,info:null}:(console.error("Video buffer header is illegal"),!1)}(e);this._Log("parse video message",t),t&&this.onreceive(c({type:"V"},t))}}_handleAudioMessage(e){if(e){this._Log("Receive Audio Message",e);var t=function(e){const t=new Uint8Array(e),i={};let s=0;if(87===t[0]&&87===t[1]&&65===t[3]){const e=t.slice(10,14);var o=new DataView(e.buffer);if(i.timestamp=o.getUint32(0),1&t[9]){switch(t[14]){case 1:i.incodeType="G711A";break;case 2:i.incodeType="G711U";break;case 3:i.incodeType="G722.1";break;case 4:i.incodeType="G726";break;case 5:i.incodeType="AAC";break;case 6:i.incodeType="PCM";break;case 7:i.incodeType="SVAC";break;case 8:i.incodeType="ADPCM";break;default:i.incodeType=t[14]}i.channelNum=0===t[15]?1:t[15],i.bitDepth=0===t[16]?16:t[16];let e=t[19]+256*t[18]+256*t[17]*256;0===e&&(e=void 0!==h[i.incodeType]?h[i.incodeType]:0),i.sampleRate=0===e?16e3:e,s=20}else s=14;if(t[9]>>1&1){var r=t[s];s++,i.other_spread=t.slice(s,r),s+=r}return{data:t.slice(s),info:i}}return 0===t[0]&&0===t[1]&&(1===t[2]||0===t[2]&&1===t[3])?{data:t,info:null}:(console.error("Audio buffer header is illegal"),!1)}(e);this._Log("parse video message",t),t&&this.onreceive(c({type:"A"},t))}}_Log(){this.config.isDebug&&console.log(`[ ${this.TAG}|${this.WCS_ID} ] : `,...arguments)}_setLoginType(e){e&&!o(e.token)?(this._loginType="token",this._loginParams={token:e.token}):!e||o(e.user_name)||o(e.password)?(this._loginParams={},this._loginType=""):(this._loginParams={user_name:e.user_name,password:e.password},this._loginType="username")}}window&&(window.WCSWebsocket=_);t.default=_}])}));